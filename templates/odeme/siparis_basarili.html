{% extends "base.html" %}

{% block content %}
<div class="container mt-5 mb-5 text-center">
    <div class="card shadow-lg p-5">
        <div class="card-body">
            <i class="fas fa-check-circle text-success fa-5x mb-4"></i>
            <h2 class="card-title text-success">Ödeme Başarılı!</h2>
            <p class="card-text lead">Siparişiniz başarıyla alınmıştır.</p>
            
            <hr>
            
            <div class="alert alert-info d-inline-block">
                <strong>Sipariş Numaranız:</strong> #{{ siparis.id }}
            </div>
            
            <p class="mt-3">
                Siparişiniz kargoya verildiğinde bilgilendirme e-postası <strong>{{ siparis.email }}</strong> adresine gönderilecektir.
            </p>
            
            <div class="mt-4">
                <a href="{% url 'anasayfa' %}" class="btn btn-primary">Anasayfaya Dön</a>
                <a href="{% url 'odeme:kitap_listesi' %}" class="btn btn-outline-secondary">Alışverişe Devam Et</a>
            </div>
        </div>
    </div>
    <script>
        // Sayısal değeri JS formatına uygun hale getirmek için string dönüşümü yapıyoruz
        var siparisTutar = "{{ siparis.toplam_tutar|stringformat:'s' }}";
        // Virgül varsa noktaya çevir (Türkçe ondalık formatı önlemi)
        siparisTutar = siparisTutar.replace(',', '.');

        fbq('track', 'Purchase', {
            value: parseFloat(siparisTutar),
            currency: 'TRY',
            content_name: 'Sipariş #' + '{{ siparis.id }}',
            content_ids: ['{{ siparis.id }}'],
            content_type: 'product',
            num_items: {{ siparis.items.count|default:1 }} 
        });
</script>
</div>
{% endblock %}
